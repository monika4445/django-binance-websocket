# Проект: Django WebSocket для стриминга цен криптовалют

## Описание

Это Django-приложение использует WebSocket и Binance API для получения и трансляции цен криптовалют в реальном времени.

## Стек технологий:

- **Django + Django Channels** — для реализации WebSocket соединений.
- **PostgreSQL** — для хранения данных о ценах криптовалют.
- **Redis** — для кеширования данных (цены криптовалют) на 5 минут.

## Установка и запуск

### 1️⃣ Установите зависимости:

```bash
pip install -r requirements.txt
```

### 2️⃣ Запустите сервер WebSocket:

```bash
daphne -b 0.0.0.0 -p 8000 core.asgi:application
```

### 3️⃣ Подключитесь через Postman:

1. Откройте Postman.
2. Нажмите **New WebSocket Request**.
3. Введите URL для подключения (замените BTC/USDT на любую другую пару, например ETH/USDT, XRP/BTC и т.д.):
   ```
   ws://127.0.0.1:8000/ws/binance/BTC/USDT/
   ```
   Где BTC/USDT — это пример торговой пары (вы можете заменить на любую криптовалюту, например, ETH/USDT, BTC/ETH).

4. Подключитесь и начинайте получать обновления цен в реальном времени.

## Пример ответа

После подключения, вы получите обновления о текущей цене криптовалюты в формате JSON:

```json
{
    "price": 87000.5
}
```

## REST API

Проект также предоставляет REST API для доступа к историческим данным и текущим ценам криптовалют. Для этого доступны следующие эндпоинты:

### **/api/prices/**

- **Метод**: `GET`
- **Описание**: Этот эндпоинт возвращает список всех доступных цен криптовалют, отсортированных по времени. Пагинация применяется для удобства.
  
  **Пример запроса**:
  ```
  GET http://localhost:8000/api/prices/
  ```

  **Пример ответа**:
  ```json
  {
      "count": 20,
      "next": "http://localhost:8000/api/prices/?page=2",
      "previous": null,
      "results": [
          {
              "pair_name": "BTC/USDT",
              "price": 45000.5,
              "formatted_timestamp": "2025-03-05 12:30:00"
          },
          {
              "pair_name": "ETH/USDT",
              "price": 3200.2,
              "formatted_timestamp": "2025-03-05 12:29:50"
          },
          ...
      ]
  }
  ```
  В ответе будет список всех цен, с возможностью пагинации для навигации между страницами.

### **/api/history/**

- **Метод**: `GET`
- **Описание**: Этот эндпоинт возвращает последние 10 цен криптовалют. Это можно изменить, чтобы получать больше или меньше данных.

  **Пример запроса**:
  ```
  GET http://localhost:8000/api/history/
  ```

  **Пример ответа**:
  ```json
  {
      "prices": [
          {
              "pair_name": "BTC/USDT",
              "price": 45000.5,
              "formatted_timestamp": "2025-03-05 12:30:00"
          },
          {
              "pair_name": "ETH/USDT",
              "price": 3200.2,
              "formatted_timestamp": "2025-03-05 12:29:50"
          },
          ...
      ]
  }
  ```

### **Настройки пагинации**

Для API используется пагинация, которая позволяет ограничить количество выводимых данных на одной странице. Количество элементов на странице можно настроить в файле `settings.py` в разделе `REST_FRAMEWORK`.

```python
REST_FRAMEWORK = {
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10,
}
```

Это означает, что при запросе данных о криптовалютах, на каждой странице будет отображаться не более 10 записей. 

## Тестирование API с использованием Postman

### **Как протестировать**:

1. Откройте Postman.
2. Для получения списка всех цен криптовалют используйте запрос:
   ```
   GET http://localhost:8000/api/prices/
   ```
   Это вернёт вам все доступные записи, с применением пагинации.

3. Для получения истории последних 10 цен используйте запрос:
   ```
   GET http://localhost:8000/api/history/
   ```
   Это вернёт последние 10 записей с ценами криптовалют.
